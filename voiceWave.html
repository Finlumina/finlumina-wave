<script>
  const dots = document.querySelectorAll(".dot");

  function startAnimation() {
    console.log("Wave: Start animation");
    clearInterval(window.waveAnim);
    window.waveAnim = setInterval(() => {
      dots.forEach((dot, i) => {
        setTimeout(() => {
          dot.style.transform = "scaleY(1.6)";
          dot.style.opacity = "1";
        }, i * 100);
        setTimeout(() => {
          dot.style.transform = "scaleY(1)";
          dot.style.opacity = "0.5";
        }, i * 100 + 300);
      });
    }, 600);
  }

  function stopAnimation() {
    console.log("Wave: Stop animation");
    clearInterval(window.waveAnim);
    dots.forEach(dot => {
      dot.style.transform = "scaleY(1)";
      dot.style.opacity = "0.5";
    });
  }

  // Detect attribute change
  const observer = new MutationObserver((mutations) => {
    mutations.forEach((m) => {
      if (m.attributeName === "data-animate") {
        const attr = document.body.getAttribute("data-animate");
        console.log("Observer saw data-animate =", attr);
        if (attr === "true") startAnimation();
        else stopAnimation();
      }
    });
  });

  observer.observe(document.body, { attributes: true });
</script>
